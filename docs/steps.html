<!DOCTYPE html><head><style type="text/css">pre code{display:block;padding:.5em;color:black;background:#f8f8ff}pre .comment,pre .template_comment,pre .diff .header,pre .javadoc{color:#998;font-style:italic}pre .keyword,pre .css .rule .keyword,pre .winutils,pre .javascript .title,pre .lisp .title,pre .subst{color:black;font-weight:bold}pre .number,pre .hexcolor{color:#40a070}pre .string,pre .tag .value,pre .phpdoc,pre .tex .formula{color:#d14}pre .title,pre .id{color:#900;font-weight:bold}pre .javascript .title,pre .lisp .title,pre .subst{font-weight:normal}pre .class .title,pre .haskell .label,pre .tex .command{color:#458;font-weight:bold}pre .tag,pre .tag .title,pre .rules .property,pre .django .tag .keyword{color:navy;font-weight:normal}pre .attribute,pre .variable,pre .instancevar,pre .lisp .body{color:teal}pre .regexp{color:#009926}pre .class{color:#458;font-weight:bold}pre .symbol,pre .ruby .symbol .string,pre .ruby .symbol .keyword,pre .ruby .symbol .keymethods,pre .lisp .keyword,pre .tex .special,pre .input_number{color:#990073}pre .builtin,pre .built_in,pre .lisp .title{color:#0086b3}pre .preprocessor,pre .pi,pre .doctype,pre .shebang,pre .cdata{color:#999;font-weight:bold}pre .deletion{background:#fdd}pre .addition{background:#dfd}pre .diff .change{background:#0086b3}pre .chunk{color:#aaa}pre .tex .formula{opacity:.5}#docs {margin:auto}.block {clear:both}.comment {padding: 0 10px;width:50%;background:snow}.code {width:49%;background:#f8f8ff}td {vertical-align:top}table {width:90%; border-collapse:collapse}
</style></head><body><table id="docs"><tr class="block"><td class="comment"><h2>createStep</h2>

<h3>Args:</h3>

<ul>
<li><em>step {String}</em>: name of step</li>
<li><em>onFile {Function}</em>: </li>
</ul></td><td class="code"><pre><code>createStep = <span class="params">( step, onFile )</span><span class="function">-></span>
    <span class="keyword">return</span> <span class="params">( item, done )</span> <span class="function">-></span></code></pre></td></tr><tr class="block"><td class="comment"><p>If this step is not in the config, skip it.</p></td><td class="code"><pre><code>        <span class="keyword">unless</span> config[step]
            done item
        <span class="keyword">else</span>
            onStep <span class="string">"Step - <span class="subst">#{step}</span>: <span class="subst">#{item}</span>"</span>
            readFile item, <span class="params">( file_contents )</span> <span class="function">-></span>
                onFile item, file_contents, done
</code></pre></td></tr><tr class="block"><td class="comment"><h2>createTransformStep</h2>

<h3>Args:</h3>

<ul>
<li><em>step {String}</em>: name of step</li>
<li><em>transform {Function}</em>: transforms the file's contents</li>
<li><em>rename {Function}</em>: generate new name based on original name</li>
</ul></td><td class="code"><pre><code>createTransformStep = <span class="params">( step, transform, rename )</span><span class="function">-></span>
    <span class="keyword">return</span> <span class="params">( item, done )</span> <span class="function">-></span></code></pre></td></tr><tr class="block"><td class="comment"><p>If this step is not in the config, skip it.</p></td><td class="code"><pre><code>        <span class="keyword">unless</span> config[step]
            done item
        <span class="keyword">else</span>
            onStep <span class="string">"Step - <span class="subst">#{step}</span>: <span class="subst">#{item}</span>"</span>
            erase = <span class="literal">false</span></code></pre></td></tr><tr class="block"><td class="comment"><p>New output file path generated by <em>rename</em></p></td><td class="code"><pre><code>            output = rename item, <span class="params">()</span> <span class="function">-></span> erase = <span class="literal">true</span></code></pre></td></tr><tr class="block"><td class="comment"><p>Perform the transform step, erasing the original file if supposed to</p></td><td class="code"><pre><code>            transformFile item, transform, output, <span class="params">( x )</span> <span class="function">-></span>
                onComp<span class="reserved">let</span>e <span class="string">"Step - <span class="subst">#{step}</span> successful for <span class="subst">#{item}</span>"</span>
                <span class="keyword">if</span> erase
                  fs.unlink item, <span class="params">()</span> <span class="function">-></span> done x
                <span class="keyword">else</span>
                  done x
</code></pre></td></tr><tr class="block"><td class="comment"><h2>renameFile</h2>

<p>Transform step for renaming output files<br />* <em>step</em>: rename</p></td><td class="code"><pre><code>renameFile = createTransformStep <span class="string">"rename"</span>,</code></pre></td></tr><tr class="block"><td class="comment"><p>No additional transform beyond renaming  </p></td><td class="code"><pre><code>  <span class="params">( x, done )</span> <span class="function">-></span>
    done x
  ,</code></pre></td></tr><tr class="block"><td class="comment"><p>Rename the file</p></td><td class="code"><pre><code>  <span class="params">( x, erase )</span> <span class="function">-></span>
    name = require<span class="params">(<span class="string">'path'</span>)</span>.basename x
    newName = config.getName name
    path = x
    <span class="keyword">unless</span> name == newName
      path = x.replace<span class="params">( name, newName )</span>
      onEvent <span class="string">"... renaming <span class="subst">#{x}</span> to <span class="subst">#{path}</span>"</span>
      erase<span class="params">()</span></code></pre></td></tr><tr class="block"><td class="comment"><p>fs.renameSync x, path<br />Return new path</p></td><td class="code"><pre><code>    path
</code></pre></td></tr><tr class="block"><td class="comment"><h2>lint</h2>

<p>Analysis step checks for bad practices and non-conformant code<br />* <em>step</em>: lint</p></td><td class="code"><pre><code>lint = createStep <span class="string">"lint"</span>, <span class="params">( item, file, done )</span> <span class="function">-></span>
    result = jslint file, {}
    <span class="keyword">unless</span> result
        onError <span class="string">"LINT FAILED ON <span class="subst">#{item}</span>"</span>
        errors = _.select<span class="params">( jslint.errors, ( e )</span> <span class="function">-></span> e )
        console.log <span class="string">"   line <span class="subst">#{x.line}</span>, pos <span class="subst">#{x.character}</span> - <span class="subst">#{x.reason}</span>"</span>.red <span class="keyword">for</span> x <span class="keyword">in</span> errors
    <span class="keyword">else</span>
        onComp<span class="reserved">let</span>e <span class="string">"<span class="subst">#{item}</span> passed lint!"</span>
    done item
</code></pre></td></tr><tr class="block"><td class="comment"><h2>uglify</h2>

<p>Minifies javascript and outputs a minified file alongside the unminified version<br />* <em>step</em>: uglify</p></td><td class="code"><pre><code>uglify = createTransformStep <span class="string">"uglify"</span>,</code></pre></td></tr><tr class="block"><td class="comment"><p>Minify the file </p></td><td class="code"><pre><code>    <span class="params">( x, done )</span> <span class="function">-></span>
        ast = jsp.parse x
        ast = pro.ast_mangle ast
        ast = pro.ast_squeeze ast
        done pro.gen_code ast
    ,</code></pre></td></tr><tr class="block"><td class="comment"><p>Generate filename for minified file</p></td><td class="code"><pre><code>    <span class="params">( x )</span> <span class="function">-></span> x.replace<span class="params">(<span class="string">".js"</span>,<span class="string">"."</span> + ext.uglify + <span class="string">".js"</span>)</span>
</code></pre></td></tr><tr class="block"><td class="comment"><h2>gzip</h2>

<p>Creates a gzipped version of the file<br />* <em>step</em>: gzip</p></td><td class="code"><pre><code>gzip = createTransformStep <span class="string">"gzip"</span>,</code></pre></td></tr><tr class="block"><td class="comment"><p>Gzip file</p></td><td class="code"><pre><code>    <span class="params">( x, done )</span> <span class="function">-></span>
        gzipper x, <span class="params">( err, result )</span> <span class="function">-></span> done result
    ,</code></pre></td></tr><tr class="block"><td class="comment"><p>Generate filename for gzipped file</p></td><td class="code"><pre><code>    <span class="params">( x )</span> <span class="function">-></span> x.replace<span class="params">(<span class="string">".js"</span>,<span class="string">"."</span> + ext.gzip + <span class="string">".js"</span>)</span>
</code></pre></td></tr><tr class="block"><td class="comment"><h2>wrap</h2>

<p>Applies wrapper code/comments<br />* <em>step</em>: wrap</p></td><td class="code"><pre><code>wrap = createTransformStep <span class="string">"wrap"</span>,
    <span class="params">( x, done )</span> <span class="function">-></span>
        <span class="keyword">if</span> config.wrap.prefix
            x = config.wrap.prefix + <span class="string">"\n"</span> + x
        <span class="keyword">if</span> config.wrap.suffix
            x = x + <span class="string">"\n"</span> + config.wrap.suffix
        done x
    ,</code></pre></td></tr><tr class="block"><td class="comment"><p>No rename. Just return the original</p></td><td class="code"><pre><code>    <span class="params">( x )</span> <span class="function">-></span> x
</code></pre></td></tr><tr class="block"><td class="comment"><h2>finalize</h2>

<p>Apply final header and footer<br />* <em>step</em>: finalize</p></td><td class="code"><pre><code>finalize = createTransformStep <span class="string">"finalize"</span>,
    <span class="params">( x, done )</span> <span class="function">-></span>
      <span class="keyword">if</span> config.finalize.header
        x = <span class="string">"<span class="subst">#{ config.finalize.header }</span>\n<span class="subst">#{ x }</span>"</span>
      <span class="keyword">if</span> config.finalize.footer
        x = x + <span class="string">"\n<span class="subst">#{ config.finalize.footer }</span>\n"</span>
      done x
    ,</code></pre></td></tr><tr class="block"><td class="comment"><p>No rename. Just return the original</p></td><td class="code"><pre><code>    <span class="params">( x )</span> <span class="function">-></span> x</code></pre></td></tr></table></body>