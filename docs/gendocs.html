<!DOCTYPE html><head><style type="text/css">pre code{display:block;padding:.5em;color:black;background:#f8f8ff}pre .comment,pre .template_comment,pre .diff .header,pre .javadoc{color:#998;font-style:italic}pre .keyword,pre .css .rule .keyword,pre .winutils,pre .javascript .title,pre .lisp .title,pre .subst{color:black;font-weight:bold}pre .number,pre .hexcolor{color:#40a070}pre .string,pre .tag .value,pre .phpdoc,pre .tex .formula{color:#d14}pre .title,pre .id{color:#900;font-weight:bold}pre .javascript .title,pre .lisp .title,pre .subst{font-weight:normal}pre .class .title,pre .haskell .label,pre .tex .command{color:#458;font-weight:bold}pre .tag,pre .tag .title,pre .rules .property,pre .django .tag .keyword{color:navy;font-weight:normal}pre .attribute,pre .variable,pre .instancevar,pre .lisp .body{color:teal}pre .regexp{color:#009926}pre .class{color:#458;font-weight:bold}pre .symbol,pre .ruby .symbol .string,pre .ruby .symbol .keyword,pre .ruby .symbol .keymethods,pre .lisp .keyword,pre .tex .special,pre .input_number{color:#990073}pre .builtin,pre .built_in,pre .lisp .title{color:#0086b3}pre .preprocessor,pre .pi,pre .doctype,pre .shebang,pre .cdata{color:#999;font-weight:bold}pre .deletion{background:#fdd}pre .addition{background:#dfd}pre .diff .change{background:#0086b3}pre .chunk{color:#aaa}pre .tex .formula{opacity:.5}#docs {margin:auto}.block {clear:both}.comment {padding: 0 10px;width:50%;background:snow}.code {width:49%;background:#f8f8ff}td {vertical-align:top}table {width:90%; border-collapse:collapse}
</style></head><body><table id="docs"><tr class="block"><td class="comment"></td><td class="code"><pre><code>doc_generators = 
	ape: require <span class="string">'ape'</span>
	docco: require <span class="string">'docco'</span>
</code></pre></td></tr><tr class="block"><td class="comment"><h1>gendocs</h1>

<p>Sets up doc output path and ensures default config options are set (if not <br />present in build.json) then iterates files and generates docs<br />Called by <em>pack</em> function in main.cofee<br />gendocs key in build.json options:<br /><pre><code><br />gendocs: {<br />    generator: 'docco', // (or 'ape'; defaults to 'ape'),<br />    source: 'dirname',  // (if in project root else relative path; defaults to 'src')<br />    output: 'dirname'   // (if in project root else relative path; defaults to 'docs')<br />}<br /></code></pre></p></td><td class="code"><pre><code>gendocs = <span class="function">-></span>
	<span class="keyword">unless</span> config.gendocs?
		<span class="literal">false</span>
	<span class="keyword">else</span></code></pre></td></tr><tr class="block"><td class="comment"><p>A little bit of housekeeping</p></td><td class="code"><pre><code>		conf = config.gendocs
		conf.generator ?= <span class="string">'ape'</span>
		conf.output ?= <span class="string">'docs'</span>
		conf.sourcePaths = <span class="keyword">if</span> _.isArray<span class="params">(conf.sources)</span> <span class="keyword">then</span> conf.sources <span class="keyword">else</span> [conf.sources <span class="keyword">or</span> <span class="string">'src'</span>]</code></pre></td></tr><tr class="block"><td class="comment"><p>Make sure that we have a docs output path on the filesystem</p></td><td class="code"><pre><code>		ensurePath conf.output, <span class="params">(exists)</span> <span class="function">-></span> </code></pre></td></tr><tr class="block"><td class="comment"><p>Crawl source paths for files to generate docs for</p></td><td class="code"><pre><code>			conf.sourcePaths.forEach <span class="params">(dirname)</span> <span class="function">-></span>
				forFilesIn dirname, generate_docs_for_file, <span class="function">-></span> 
					<span class="keyword">if</span> conf.generator <span class="keyword">is</span> <span class="string">'docco'</span>
						style_path = path.join<span class="params">(conf.output, <span class="string">'stylesheets'</span>)</span>
						ensurePath style_path, <span class="params">(exists)</span> <span class="function">-></span>
							fs.readFile path.join<span class="params">(config.ext, <span class="string">'docco.css'</span>)</span>, <span class="params">(err, stylesheet)</span> <span class="function">-></span>
								fs.writeFile path.join<span class="params">(style_path, <span class="string">'docco.css'</span>)</span>, stylesheet, <span class="function">-></span>
									onComp<span class="reserved">let</span>e <span class="string">'fin√®'</span>

</code></pre></td></tr><tr class="block"><td class="comment"><h2>generate_docs_for_file</h2>

<p>Checks for existence of <em>file</em> in <em>dir</em> and calls <em>generate_docs_from_string</em><br />on it if it does.</p>

<h3>Args:</h3>

<ul>
<li><em>dir {String}</em>: directory name</li>
<li><em>file {String}</em>: file name</li>
<li><em>done {Function}</em>: callback to call when finished</li>
</ul></td><td class="code"><pre><code>generate_docs_for_file = <span class="params">(dir, file, done)</span> <span class="function">-></span>
	file_path = path.join<span class="params">(dir, file)</span>
	conf = config.gendocs
	path.exists<span class="params">(file_path, (exists)</span> <span class="function">-></span> 
		<span class="keyword">if</span> exists
			fs.readFile<span class="params">(file_path, (err, file_contents)</span> <span class="function">-></span> 
				onStep <span class="string">'Generating docs for '</span> + file_path
				generate_docs_from_string file_contents.toString<span class="params">()</span>, file, done
			)
		<span class="keyword">else</span>
			onError file_path, <span class="string">'does not exist!'</span>
	)
</code></pre></td></tr><tr class="block"><td class="comment"><h2>get_doc_generator_method</h2>

<p>Get a reference to the correct documentation generator function given the library name</p>

<h3>Args:</h3>

<ul>
<li><em>name {String}</em>: the name of the doc generator library (ape|docco)</li>
</ul></td><td class="code"><pre><code>get_doc_generator_method = <span class="params">(name)</span> <span class="function">-></span>
	<span class="keyword">if</span> name <span class="keyword">is</span> <span class="string">'ape'</span> <span class="keyword">then</span> doc_generators.ape.generate_doc <span class="keyword">else</span> doc_generators.docco.generate_doc_from_string
</code></pre></td></tr><tr class="block"><td class="comment"><h2>generate_docs_from_string</h2>

<h3>Args:</h3>

<ul>
<li><em>code {String}</em>: the contents of the file</li>
<li><em>file {String}</em>: the file's name</li>
<li><em>done {Function}</em>: callback to call when finished</li>
</ul></td><td class="code"><pre><code>generate_docs_from_string = <span class="params">(code, file, done)</span> <span class="function">-></span>
	conf = config.gendocs
	doc_generator = get_doc_generator_method<span class="params">(conf.generator)</span>
	lang = doc_generators.ape.get_language file
</code></pre></td></tr><tr class="block"><td class="comment"><h2>write_doc_file</h2>

<p>Writes the generated documentation HTML to a file and calls the <em>done</em> callback</p>

<h3>Args:</h3>

<ul>
<li><em>err {Multiple}</em>: may be a string or Error object indicating an error</li>
<li><em>docs {String}</em>: generated HTML documentation page</li>
</ul></td><td class="code"><pre><code>	write_doc_file = <span class="params">(err, docs)</span> <span class="function">-></span>
		<span class="keyword">if</span> conf.generator <span class="keyword">is</span> <span class="string">'docco'</span>
			docs = err
		outfile = path.join<span class="params">(conf.output, file.replace(/\.(js|coffee)</span>$/, <span class="string">'.html'</span>))
		fs.writeFile outfile, docs, <span class="params">(err)</span> <span class="function">-></span> 
			<span class="keyword">if</span> err 
				onError err
			done<span class="params">()</span>

	<span class="keyword">if</span> conf.generator <span class="keyword">is</span> <span class="string">'ape'</span>
		doc_generator code, lang, <span class="string">'html'</span>, <span class="literal">null</span>, write_doc_file

	<span class="keyword">if</span> conf.generator <span class="keyword">is</span> <span class="string">'docco'</span>
		<span class="keyword">if</span> lang <span class="keyword">and</span> lang.name? 
			lang = <span class="keyword">if</span> lang.name == <span class="string">'coffeescript'</span> <span class="keyword">then</span> <span class="string">'.coffee'</span> <span class="keyword">else</span> <span class="string">'.js'</span>
		doc_generator filename, code, lang, write_doc_file</code></pre></td></tr></table></body>